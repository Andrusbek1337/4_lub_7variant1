#include <iostream>
#include <iomanip>
#include <stdexcept>
#include <limits>
#include <string>

class Time {
private:
    short int hours;
    short int minutes;

    // Метод для нормализации времени
    void normalize() {
        if (minutes >= 60) {
            hours += minutes / 60;
            minutes %= 60;
        }
        else if (minutes < 0) {
            hours -= (-minutes + 59) / 60;
            minutes = (minutes % 60 + 60) % 60;
        }

        if (hours >= 24) {
            hours %= 24;
        }
        else if (hours < 0) {
            hours = (hours % 24 + 24) % 24;
        }
    }

public:
    // Конструктор по умолчанию
    Time() : hours(0), minutes(0) {}

    // Конструктор с параметрами
    Time(short int h, short int m) : hours(h), minutes(m) {
        if (!isValidTime(h, m)) {
            throw std::invalid_argument("Некорректное время: часы должны быть от 0 до 23, минуты от 0 до 59");
        }
        normalize(); // Если минуты > 59
    }

    // Конструктор копирования
    Time(const Time& other) : hours(other.hours), minutes(other.minutes) {}

    // Геттеры
    short int getHours() const { return hours; }
    short int getMinutes() const { return minutes; }

    // Сеттеры
    void setHours(short int h) {
        if (h < 0 || h > 23) {
            throw std::invalid_argument("Часы должны быть от 0 до 23");
        }
        hours = h;
    }

    void setMinutes(short int m) {
        if (m < 0 || m > 59) {
            throw std::invalid_argument("Минуты должны быть от 0 до 59");
        }
        minutes = m;
    }

    // Проверка корректности времени
    static bool isValidTime(short int h, short int m) {
        return (h >= 0 && h <= 23) && (m >= 0 && m <= 59);
    }

    // Метод вычитания переменной типа Time
    Time subtract(const Time& other) const {
        int totalMinutes1 = hours * 60 + minutes;
        int totalMinutes2 = other.hours * 60 + other.minutes;
        int diffMinutes = totalMinutes1 - totalMinutes2;

        // Обработка перехода через сутки
        if (diffMinutes < 0) {
            diffMinutes += 24 * 60;
        }

        short int resultHours = diffMinutes / 60;
        short int resultMinutes = diffMinutes % 60;

        // Нормализация результата
        if (resultHours >= 24) {
            resultHours %= 24;
        }

        return Time(resultHours, resultMinutes);
    }

    //УНАРНЫЕ ОПЕРАЦИИ_______________________________________________________________________

    // Префиксный инкремент (++time) - добавляет минуту
    Time& operator++() {
        minutes++;
        normalize();
        return *this;
    }

    // Постфиксный инкремент (time++) - добавляет минуту
    Time operator++(int) {
        Time temp = *this;
        minutes++;
        normalize();
        return temp;
    }

    // Префиксный декремент (--time) - вычитает минуту
    Time& operator--() {
        minutes--;
        normalize();
        return *this;
    }

    // Постфиксный декремент (time--) - вычитает минуту
    Time operator--(int) {
        Time temp = *this;
        minutes--;
        normalize();
        return temp;
    }

    // ОПЕРАЦИИ ПРИВЕДЕНИЯ_______________________________________________________________

    // Неявное приведение к int (количество минут)
    operator int() const {
        return hours * 60 + minutes;
    }

    // Явное приведение к bool (true если время не 00:00)
    explicit operator bool() const {
        return (hours != 0 || minutes != 0);
    }

    // БИНАРНЫЕ ОПЕРАЦИИ_____________________________________________________________________

    // Оператор меньше
    bool operator<(const Time& other) const {
        return (hours * 60 + minutes) < (other.hours * 60 + other.minutes);
    }

    // Оператор больше
    bool operator>(const Time& other) const {
        return (hours * 60 + minutes) > (other.hours * 60 + other.minutes);
    }

    // Оператор равенства
    bool operator==(const Time& other) const {
        return (hours == other.hours) && (minutes == other.minutes);
    }

    // Оператор неравенства
    bool operator!=(const Time& other) const {
        return !(*this == other);
    }

    // Перегрузка оператора вывода
    friend std::ostream& operator<<(std::ostream& os, const Time& time) {
        os << std::setw(2) << std::setfill('0') << time.hours << ":"
            << std::setw(2) << std::setfill('0') << time.minutes;
        return os;
    }
};

// Проверкой на не числа
short int inputNumber(const std::string& prompt, short int min, short int max) {
    short int value;
    std::string input;

    while (true) {
        std::cout << prompt;
        std::cin >> input;

        // Проверяем, что ввод состоит только из цифр
        bool isNumber = true;
        for (char c : input) {
            if (!std::isdigit(c) && !(c == '-' && &c == &input[0])) {
                isNumber = false;
                break;
            }
        }

        if (!isNumber) {
            std::cout << "Вы ввели число, а не текст.\n";
            std::cin.clear();
            std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
            continue;
        }

        // Преобразуем строку в число
        try {
            value = std::stoi(input);

            // Проверяем диапазон
            if (value >= min && value <= max) {
                break;
            }
            else {
                std::cout << "Число должно быть от " << min << " до " << max << ".\n";
            }
        }
        catch (const std::exception&) {
            std::cout << "Неверное число.\n";
        }

        std::cin.clear();
        std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
    }

    return value;
}

// Функция для ввода времени
Time inputTime(const std::string& prompt) {
    std::cout << prompt;

    short int h = inputNumber("Введите часы (0-23): ", 0, 23);
    short int m = inputNumber("Введите минуты (0-59): ", 0, 59);

    return Time(h, m);
}

int main() {
    setlocale(LC_ALL, "Russian");
    try {

        // 1. Тестирование конструкторов
        std::cout << "1. Тестирование конструкторов:\n";
        Time t1;
        std::cout << "Конструктор по умолчанию: " << t1 << "\n";

        Time t2 = inputTime("Введите время для конструктора с параметрами:\n");
        std::cout << "Конструктор с параметрами: " << t2 << "\n";

        Time t3(t2);
        std::cout << "Конструктор копирования: " << t3 << "\n\n";

        // 2. Тестирование геттеров и сеттеров
        std::cout << "2. Тестирование геттеров и сеттеров:\n";
        Time t4;

        short int hours = inputNumber("Введите часы для setHours (0-23): ", 0, 23);
        t4.setHours(hours);

        short int minutes = inputNumber("Введите минуты для setMinutes (0-59): ", 0, 59);
        t4.setMinutes(minutes);

        std::cout << "setHours(" << hours << "), setMinutes(" << minutes << "): " << t4 << "\n";
        std::cout << "getHours(): " << t4.getHours() << "\n";
        std::cout << "getMinutes(): " << t4.getMinutes() << "\n\n";

        // 3. Тестирование оператора вывода
        std::cout << "3. Тестирование оператора вывода:\n";
        Time t5(5, 7);
        std::cout << "Время: " << t5 << " (форматированный вывод)\n\n";

        // 4. Тестирование метода вычитания
        std::cout << "4. Тестирование метода вычитания:\n";
        Time t6 = inputTime("Введите первое время для вычитания:\n");
        Time t7 = inputTime("Введите второе время для вычитания:\n");
        Time result1 = t6.subtract(t7);
        std::cout << t6 << " - " << t7 << " = " << result1 << "\n\n";

        // 5. Тестирование унарных операций
        std::cout << "5. Тестирование унарных операций (++, --):\n";
        Time t8 = inputTime("Введите время для тестирования ++ и --:\n");
        std::cout << "Исходное время: " << t8 << "\n";

        std::cout << "Префиксный инкремент (++t): " << ++t8 << "\n";
        std::cout << "Постфиксный инкремент (t++): " << t8++ << "\n";
        std::cout << "После постфиксного инкремента: " << t8 << "\n";

        std::cout << "Префиксный декремент (--t): " << --t8 << "\n";
        std::cout << "Постфиксный декремент (t--): " << t8-- << "\n";
        std::cout << "После постфиксного декремента: " << t8 << "\n\n";

        // 6. Тестирование операций приведения
        std::cout << "6. Тестирование операций приведения типа:\n";
        Time t11 = inputTime("Введите время для тестирования приведений:\n");

        // Неявное приведение к int
        int minutes_total = t11;
        std::cout << "Неявное приведение к int: " << minutes_total << " минут\n";

        // Явное приведение к bool
        bool isNonZero = static_cast<bool>(t11);
        std::cout << "Явное приведение к bool: " << std::boolalpha << isNonZero << "\n\n";

        if (t11) {
            std::cout << "Время " << t11 << " не равно 00:00\n";
            std::cout << "Оно равно " << (int)t11 << " минутам\n";
        }
        else {
            std::cout << "Время равно 00:00\n";
        }
        std::cout << "\n";

        // 7. Тестирование бинарных операций
        std::cout << "7. Тестирование бинарных операций (<, >):\n";
        Time t12 = inputTime("Введите первое время для сравнения:\n");
        Time t13 = inputTime("Введите второе время для сравнения:\n");

        std::cout << "\nСравнение:\n";
        std::cout << "t1 = " << t12 << " (" << (int)t12 << " минут)\n";
        std::cout << "t2 = " << t13 << " (" << (int)t13 << " минут)\n\n";

        std::cout << "t1 < t2: " << std::boolalpha << (t12 < t13) << "\n";
        std::cout << "t1 > t2: " << std::boolalpha << (t12 > t13) << "\n";
        std::cout << "t1 == t2: " << std::boolalpha << (t12 == t13) << "\n";
        std::cout << "t1 != t2: " << std::boolalpha << (t12 != t13) << "\n\n";

        if (t12 < t13) {
            std::cout << t12 << " раньше, чем " << t13 << "\n";
        }
        else if (t12 > t13) {
            std::cout << t12 << " позже, чем " << t13 << "\n";
        }
        else {
            std::cout << t12 << " и " << t13 << " равны\n";
        }

    }
    catch (const std::exception& e) {
        std::cout << "Произошла ошибка: " << e.what() << "\n";
        return 1;
    }

    return 0;
}
